generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model AuditTrail {
  id          String   @id @default(cuid())
  timestamp   DateTime @default(now())
  action      String
  userId      String
  userName    String
  userRole    String?
  caseId      String
  caseType    String
  field       String?
  oldValue    String?
  newValue    String?
  description String?
  metadata    String?

  @@index([caseId, caseType])
  @@index([timestamp])
  @@index([action])
  @@index([userId])
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  draft_id String?  // Optional field to link to a draft
  reference Json
  payload   Json
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([userId, isRead])
  @@index([createdAt])
  @@map("notifications")
}

model NotificationType {
  id          String   @id @default(cuid())
  code        String   @unique
  name        String
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())

  @@map("notification_types")
}

model ServiceCode {
  id          String   @id @default(cuid())
  code        String   @unique
  name        String
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())

  @@map("service_codes")
}

model Comment {
  id        String   @id @default(cuid())
  content   String
  createdAt DateTime @default(now())
  userId    String
  userName  String
  userRole  String?
  caseId    String
  caseType  String

  @@index([caseId, caseType])
}

model Draft {
  id          String   @id @default(cuid())
  content     Json   // JSON string of form data
  formType    String   // Type of form being drafted
  status      String   @default("draft") // e.g., "draft", "submitted"
  currentStep Int?    // Current step in multi-step forms
  fields      Json? // List of fields included in the draft
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // User information
  userId      String
  userName    String
  userRole    String?
  
  // Case information (optional - for case-related forms)
  caseId      String?
  caseType    String?
  
  // Make sure only one draft per user per form type per case
  @@unique([userId, formType, caseId])
  @@index([userId, formType])
  @@index([caseId, caseType])
}